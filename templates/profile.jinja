{% extends 'base.jinja' %}

{% block title %}
Your Page Title
{% endblock %}

{% block content %}


<div class="topnav">
    
    <h1 style="text-align: center">Academic Platform for Students</h1>
    <h2 style="text-align:left"> <a href="{{ url_for('logout') }}">Forum</a> </h2>
    <a href="{{ url_for('chat', username=username) }}">Messaging</a>
    <a class="active" href="{{ url_for('friends') }}">Profile</a>
    <a href="{{ url_for('logout') }}">Logout</a>
</div>
<div class="row">
<div class="column left">
    <h2 class="picture">Profile picture</h2>
    <h2 style="text-align: center">{{ username }}</h2>
</div>

<div class="column middle">
    <ul>
        {% for friend in friends %}
            <li>{{ friends.name }}</li>
        {% endfor %}
    </ul>

     <ul id="list"></ul>
     
    <script>
        let list = document.getElementById('list');
        // Append the button to the list item
        for (let i = 0; i < {{ friends }}.length; i++) {
            let li = document.createElement('li');
            li.textContent = {{ friends }}[i];  

            list.appendChild(li);
        }


    <h2 class="addnewfriend">To add new friend</h2>
    <input type="text" id="newFriend" placeholder="Enter friend's name">
    <button onclick="addFriend()">Add Friend</button>
    <h2>Friends list</h2>
</div>
</div>

<!-- Script for adding a new friend -->
<script>
    function isValidURL(string) {
        if (string.length == 0) {
            return false;
        }
        if (string[0] == "/") {
            return true;
        }
        return false;
    }

    async function addFriend() {
        let addFriendURL = "{{ url_for('add_friend') }}";
        let recipient = document.getElementById('newFriend').value;
        let res = await axios.post(addFriendURL, {
            recipient: recipient,
        });

        if (!isValidURL(res.data)) {
            alert(res.data);
            return;
        }

        window.open(res.data, "_self");
    }
</script>
 
<!-- section for sending and receiving friend request --> 
 <h1>Friend Requests</h1>
    <ul id="friend-requests">
        <!-- Display pending friend requests here -->
        {% for request in requests %}
            <li>{{ request }} sent you a friend request 
                <button onclick="acceptFriendRequest('{{ request }}')">Accept</button>
                <button onclick="declineFriendRequest('{{ request }}')">Decline</button>
            </li>
        {% endfor %}
    </ul>

    <script type="text/javascript">
        // Function to handle accepting friend requests
        async function acceptFriendRequest(sender) {
            let acceptFriendURL = "{{ url_for('accept_friend_request') }}";

            let res = await axios.post(acceptFriendURL, {
                sender: sender,
            });

            // If the server sends in an error message, alert() the error message
            if (!isValidURL(res.data)) {
                alert("request");
                return;
            }

            // Reload the page after accepting the request
            location.reload();
            alert("Friend request from " + sender + " accepted successfully!");
        }

        // Function to handle declining friend requests
        async function declineFriendRequest(sender) {
            let declineFriendURL = "{{ url_for('decline_friend_request') }}";

            let res = await axios.post(declineFriendURL, {
                sender: sender,
            });

            // If the server sends in an error message, alert() the error message
            if (!isValidURL(res.data)) {
                alert(res.data);
                return;
            }

            // Reload the page after declining the request
            location.reload();
            alert("Friend request from " + sender + " declined successfully!");
        }
    </script>

{% endblock %}